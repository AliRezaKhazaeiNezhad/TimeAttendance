@model List<TimeAttendance.Model.AnalyzedReportListModel>
@{
    Layout = null;

    List<TimeAttendance.Model.AnalyzedReportListModel> entityList = new List<TimeAttendance.Model.AnalyzedReportListModel>();

    entityList = Model;
}

<style>
    .nopadding{
        padding:5px !important;
        width:33% !important;
    }
</style>


@if (entityList == null)
{
    <div class="alert alert-warning w100 pull-right">
        داده ای یافت نشد!
    </div>
}
else
{
    foreach (var user in entityList)
    {
        <div class="panel-group pabel-accordion" id="accordion@(entityList.FindIndex(x => x.UserInformattion == user.UserInformattion))">
            <div class="panel panel-info">
                <a class="accordion-toggle accordion-toggle-styled " data-toggle="collapse" data-parent="#accordion@(entityList.FindIndex(x => x.UserInformattion == user.UserInformattion))" href="#collapse_@(entityList.FindIndex(x => x.UserInformattion == user.UserInformattion))_@(entityList.FindIndex(x => x.UserInformattion == user.UserInformattion))" aria-expanded="false">
                    <div class="panel-heading panel-heading-gray">
                        <h4 class="panel-title">
                            <table class="w100 pull-right" style="position: relative;top: -20px;">
                                <tbody>
                                    <tr>
                                        <td>
                                            @(user.UserGroup)
                                        </td>
                                        <td>
                                            @(user.UserInformattion)
                                        </td>
                                        <td>
                                            @(user.StartDate)
                                        </td>
                                        <td>
                                            @(user.EndDate)
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </h4>
                    </div>
                </a>
                <div id="collapse_@(entityList.FindIndex(x => x.UserInformattion == user.UserInformattion))_@(entityList.FindIndex(x => x.UserInformattion == user.UserInformattion))" class="panel-collapse collapse " style="">
                    <div class="panel-body">
                        <table id="Grid" class="table  table-striped table-condensed table-bordered no-margin smallTable" style="width:100% !important;">
                            <thead>
                                <tr>
                                    <th>ردیف</th>
                                    <th>وضعیت</th>
                                    <th>تاریخ</th>
                                    <th>روز</th>
                                    <th>ترددها</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (user.Reports.Count() <= 0 || Model == null)
                                {
                                    <tr>
                                        <td colspan="5">داده ای یافت نشد !</td>
                                    </tr>
                                }
                                else
                                {
                                    foreach (var item in user.Reports)
                                    {
                                        <tr>
                                            <td>
                                                @(user.Reports.FindIndex(x => x.Id == item.Id) + 1)
                                            </td>
                                            <td>
                                                @switch (item.State)
                                                {
                                                    case wskh.Core.Enumerator.AnalyzedReportState.WaitingForAnalyzing:
                                                        <span class='text-info'>درحل آنالیز</span>
                                                        break;
                                                    case wskh.Core.Enumerator.AnalyzedReportState.Presence:
                                                        <span class='text-success'>حضور</span>
                                                        break;
                                                    case wskh.Core.Enumerator.AnalyzedReportState.Absence_NoTransaction:
                                                        <span class='text-danger'>غیبت</span>
                                                        break;
                                                    case wskh.Core.Enumerator.AnalyzedReportState.Absence_Systemic:
                                                        <span class='text-danger'>غیبت سیستمی</span>
                                                        break;
                                                    case wskh.Core.Enumerator.AnalyzedReportState.FractionTrade:
                                                        <span class='text-warning'>تردد ناقص</span>
                                                        break;
                                                    case wskh.Core.Enumerator.AnalyzedReportState.RestDay:
                                                        <span class='text-dark'>روز استراحت</span>
                                                        break;
                                                    case wskh.Core.Enumerator.AnalyzedReportState.Holiday:
                                                        <span class='text-dark'>تعطیلی</span>
                                                        break;
                                                    case wskh.Core.Enumerator.AnalyzedReportState.Holiday_Presence:
                                                        <span class='text-success'>حضور-روز تعطیل</span>
                                                        break;
                                                    case wskh.Core.Enumerator.AnalyzedReportState.HolidayFraction:
                                                        <span class='text-warning'>ترددناقص-روز تعطیل</span>
                                                        break;
                                                    case wskh.Core.Enumerator.AnalyzedReportState.Holiday_Absence_NoTransaction:
                                                        <span class='text-danger'>غیبت-روز تعطیل</span>
                                                        break;
                                                    case wskh.Core.Enumerator.AnalyzedReportState.Holiday_Absence_Systemic:
                                                        <span class='text-danger'>غیبت سیستمی-روز تعطیل</span>
                                                        break;
                                                    default:
                                                        <span class='text-dark'>-</span>
                                                        break;
                                                }


                                            </td>
                                            <td>
                                                @(item.PersianDate)
                                            </td>
                                            <td>
                                                @(item.PersianDayName)
                                            </td>
                                            <td>
                                                @if (item.AnalyzedReportLogs != null)
                                                {
                                                    <table style="width:100%">
                                                        <tbody>
                                                            @foreach (var log in item.AnalyzedReportLogs)
                                                            {
                                                                <tr>
                                                                    <td class="nopadding">@(wskh.WebEssentials.DateAndTime.DateTimeHelper.ToHourMinute(log.FirstLog.LogTime))</td>
                                                                    <td class="nopadding">@(wskh.WebEssentials.DateAndTime.DateTimeHelper.ToHourMinute(log.SecondLog?.LogTime))</td>
                                                                    <td class="nopadding">@(wskh.WebEssentials.DateAndTime.DateTimeHelper.ToHourMinute(log.Duration))</td>
                                                                </tr>

                                                            }
                                                        </tbody>
                                                    </table>

                                                }
                                            </td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>



                    </div>
                </div>
            </div>
        </div>
    }
}



